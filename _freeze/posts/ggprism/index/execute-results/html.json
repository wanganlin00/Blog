{
  "hash": "9363d0b1770c875c321e3c1074bf7c60",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"ggprism: GraphPad Prism 风格\"\ndate: \"2024-09-24\"\ndate-modified: today\ncategories: [graphics, themes]\nimage: \"example.svg\"\n---\n\n\n## 先决条件\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"ggprism\")\nlibrary(ggprism)\nlibrary(patchwork)\nToothGrowth$dose <- as.factor(ToothGrowth$dose)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(ggprism_data$themes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"autumn_leaves\"   \"beer_and_ales\"   \"black_and_white\" \"candy_bright\"   \n [5] \"candy_soft\"      \"colorblind_safe\" \"colors\"          \"diazo\"          \n [9] \"earth_tones\"     \"evergreen\"       \"greenwash\"       \"muted_rainbow\"  \n[13] \"office\"          \"purple_passion\"  \"shades_of_gray\"  \"summer\"         \n[17] \"the_blues\"       \"winter_soft\"     \"stained_glass\"   \"warm_pastels\"   \n[21] \"flames\"          \"floral\"          \"inferno\"         \"magma\"          \n[25] \"mustard_field\"   \"neon\"            \"pastels\"         \"pearl\"          \n[29] \"plasma\"          \"prism_dark\"      \"prism_light\"     \"quiet\"          \n[33] \"spring\"          \"starry\"          \"viridis\"         \"waves\"          \n[37] \"blueprint\"       \"fir\"             \"ocean\"           \"sunny_garden\"   \n[41] \"wool_muffler\"    \"warm_and_sunny\"  \"winter_bright\"   \"all_null\"       \n```\n\n\n:::\n\n```{.r .cell-code}\npreview_theme(\"colors\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlengths(ggprism_data$colour_palettes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  autumn_leaves   beer_and_ales black_and_white       blueprint      blueprint2 \n              9               9               9               9               9 \n     blueprint3    candy_bright      candy_soft colorblind_safe          colors \n              9               9               9               6              20 \n          diazo     earth_tones       evergreen             fir            fir2 \n              9              10               9               9               9 \n           fir3          flames         flames2          floral         floral2 \n              9               9               9              12              12 \n      greenwash         inferno           magma   mustard_field  mustard_field2 \n             10               6               6               9               9 \n  muted_rainbow            neon           ocean          ocean2          ocean3 \n             10               9               9               9               9 \n         office         pastels           pearl          pearl2          plasma \n              9               9               6               6               6 \n     prism_dark     prism_dark2     prism_light    prism_light2  purple_passion \n             10              10              10              10               9 \n          quiet          quiet2  shades_of_gray          spring         spring2 \n              9               9               9               9               9 \n  stained_glass  stained_glass2          starry         starry2          summer \n              9               9               5               5              10 \n   sunny_garden   sunny_garden2   sunny_garden3       the_blues         viridis \n              9               9               9               9               6 \n warm_and_sunny    warm_pastels   warm_pastels2           waves          waves2 \n              9               9               9               5               5 \n  winter_bright     winter_soft    wool_muffler   wool_muffler2   wool_muffler3 \n              9               9               9               9               9 \n```\n\n\n:::\n:::\n\n\n## [ggprism](https://csdaw.github.io/ggprism/index.html)\n\n### 散点图\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(msleep[complete.cases(msleep), ], \n             aes(x = sleep_rem, y = sleep_total)) + \n  geom_point(aes(shape = factor(vore)), size = 3) + \n  theme_prism() + \n  theme(axis.title.y = element_blank())\n\np2 <- p1 + scale_shape_prism()\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n### 柱状图\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(ToothGrowth, aes(x = dose, y = len)) + \n  stat_summary(aes(fill = dose),\n               geom = \"col\", fun = mean, colour = \"black\", linewidth = 0.9) + \n  scale_y_continuous(limits = c(0, 30), expand = c(0, 0))\n\np2 <- p1 + theme_prism(base_size = 14)\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### 箱线图\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- ggplot(ToothGrowth, aes(x = supp, y = len)) + \n  geom_boxplot(aes(colour = supp, fill = supp)) + \n  theme_prism(base_size = 12)\n\np1 <- p + scale_colour_prism(palette = \"floral\") + \n  scale_fill_prism(palette = \"floral\")\n\np2 <- p + scale_colour_prism(palette = \"flames\") + \n  scale_fill_prism(palette = \"flames\")\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### 小提琴图\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_vals <- tibble::tribble(\n  ~group1, ~group2, ~p.adj,   ~y.position,\n  \"0.5\",   \"1\",     8.80e-14, 35,\n  \"0.5\",   \"2\",     1.27e-7,  39\n)\n\n\np1 <- ggplot(ToothGrowth, aes(x = dose, y = len)) + \n  geom_violin(aes(colour = dose, fill = dose), trim = FALSE) + \n  geom_boxplot(aes(fill = dose), width = 0.2, colour = \"black\") + \n  scale_y_continuous(limits = c(-5, 40))+\n    add_pvalue(p_vals, label = \"p = {p.adj}\", tip.length = 0, label.size = 4)\n\n\np2 <- p1 + \n  scale_color_prism(\"floral\") + \n  scale_fill_prism(\"floral\") + \n  theme_prism(base_size = 12) + \n  theme(legend.position = \"none\") + \n  add_pvalue(p_vals, label = \"p = {p.adj}\", tip.length = 0, label.size = 4)\n\n\np1+p2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### 轴\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- ggplot(ToothGrowth, aes(x = dose, y = len)) + \n  geom_jitter(aes(shape = dose), width = 0.2, size = 2) + \n  scale_shape_prism() + \n  theme_prism() + \n  theme(legend.position = \"none\")\n\np1 <- p + scale_y_continuous(limits = c(0, 40), guide = \"prism_minor\")\n\np2 <- p + scale_x_discrete(guide = \"prism_bracket\") + \n  scale_y_continuous(limits = c(0, 40))\n\np3 <- p + scale_y_continuous(limits = c(0, 40), guide = \"prism_offset\")\n\np4 <- p + scale_y_continuous(limits = c(0, 40), guide = \"prism_offset_minor\")\n\n(p1 + p2) / (p3 + p4)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n#### 不连续轴\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# multiply one of the len values by 100\ntg <- ToothGrowth\ntg[2, \"len\"] <- tg[2, \"len\"] * 100\n\n\nggplot(tg, aes(x = dose, y = len)) + \n  geom_jitter(aes(shape = dose), width = 0.2, size = 2) + \n  scale_shape_prism() + \n  theme_prism() + \n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np_bottom <- ggplot(tg, aes(x = dose, y = len)) + \n  geom_jitter(aes(shape = dose), width = 0.2, size = 2) + \n  scale_shape_prism() + \n  coord_cartesian(ylim = c(0, 60)) + \n  guides(x = \"prism_bracket\", y = \"prism_offset_minor\") + \n  theme_prism() + \n  theme(legend.position = \"none\")\n\np_bottom\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np_top <- ggplot(tg, aes(x = dose, y = len)) + \n  geom_jitter(aes(shape = dose), width = 0.2, size = 2) + \n  scale_shape_prism() + \n  coord_cartesian(ylim = c(1140, 1160)) +\n  scale_y_continuous(breaks = c(1140, 1160)) +\n  guides(y = \"prism_offset_minor\")\n\ntheme_outlier <- function(palette = \"black_and_white\",\n                          base_size = 14,\n                          base_family = \"sans\",\n                          base_fontface = \"bold\",\n                          base_line_size = base_size/14,\n                          base_rect_size = base_size/14,\n                          axis_text_angle = 0,\n                          border = FALSE) {\n  theme_prism(palette = palette,\n              base_size = base_size,\n              base_family = base_family,\n              base_fontface = base_fontface,\n              base_line_size = base_line_size,\n              base_rect_size = base_rect_size,\n              axis_text_angle = axis_text_angle,\n              border = border) %+replace% \n    theme(axis.title = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank(),\n          axis.line.x = element_blank(),\n          legend.position = \"none\")\n}\n\np_top <- p_top + theme_outlier()\np_top\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\np_top / p_bottom + \n  plot_layout(heights = c(1, 4)) & \n  theme(axis.text.y = element_text(colour = \"red\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n\n### p值\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create a jitter plot of the sleep data set\n# and indicate the means\np <- ggplot(sleep, aes(x = group, y = extra)) +\n  geom_jitter(aes(shape = group), width = 0.1) + \n  stat_summary(geom = \"crossbar\", fun = mean, colour = \"red\", width = 0.2) + \n  theme_prism() + \n  theme(legend.position = \"none\")\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nresult <- t.test(extra ~ group, data = sleep)$p.value\nresult <- signif(result, digits = 3)\nresult\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.0794\n```\n\n\n:::\n\n```{.r .cell-code}\ndf_p_val <- data.frame(\n  group1 = \"1\",\n  group2 = \"2\",\n  label = result,\n  y.position = 6\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(df_p_val) <- c(\"apple\", \"banana\", \"some_label\", \"some_y_position\")\n\n# add p-value brackets again\np + add_pvalue(df_p_val,\n                     xmin = \"apple\",\n                     xmax = \"banana\",\n                     label = \"some_label\",\n                     y.position = \"some_y_position\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(df_p_val) <- c(\"group1\", \"group2\", \"label\", \"y.position\")\n# change bracket and label aesthetics\np1 <- p + add_pvalue(df_p_val,\n                     colour = \"red\", # label\n                     label.size = 8, # label\n                     fontface = \"bold\", # label\n                     fontfamily = \"serif\", # label\n                     angle = 45, # label\n                     hjust = 1, # label\n                     vjust = 2, # label\n                     bracket.colour = \"blue\", # bracket\n                     bracket.size = 1, # bracket\n                     linetype = \"dashed\", # bracket\n                     lineend = \"round\") # bracket\n\n# use glue expression for label\np2 <- p + add_pvalue(df_p_val, label = \"p = {label}\")\n\n# make bracket tips longer and use coord_flip\np3 <- p + add_pvalue(df_p_val, tip.length = 0.15, coord.flip = TRUE) + \n  coord_flip()\n\n# change bracket tips independently\n# (make one side disappear and the other longer)\np4 <- p + add_pvalue(df_p_val, tip.length = c(0.2, 0))\n\n(p1 + p2) / (p3 + p4)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n### + `rstatix`\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- ggplot(ToothGrowth, aes(x = dose, y = len)) +\n  geom_boxplot(aes(fill = dose), colour = \"black\") + \n  theme_prism() + \n  theme(legend.position = \"none\")\n\ndf_p_val <- rstatix::t_test(ToothGrowth, len ~ dose, ref.group = \"0.5\") %>% \n  rstatix::add_xy_position()\n\np + add_pvalue(df_p_val, \n               label = \"p = {p.adj}\",\n               remove.bracket = TRUE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}