"0","fern_chaos <- function(iterations = 10000, seed = NULL) {"
"0","  if(!is.null(seed)) set.seed(seed)"
"0","  "
"0","  # which transformation to apply at each iteration"
"0","  transform_index <- sample("
"0","    x = 1:4, "
"0","    size = iterations, "
"0","    replace= TRUE, "
"0","    prob = c(.01, .85, .07, .07)"
"0","  )"
"0","  "
"0","  # initialise chaos game at the origin"
"0","  start <- matrix(c(0, 0))"
"0","  "
"0","  # helper function to collapse accumulated output"
"0","  bind_to_column_matrix <- function(lst) {"
"0","    do.call(cbind, lst)"
"0","  }"
"0","  "
"0","  # iterate until done!"
"0","  coord_matrix <- transform_index |>"
"0","    accumulate(fern_transform, .init = start) |>"
"0","    bind_to_column_matrix() "
"0","  "
"0","  # tidy the output, add extra columns, and return"
"0","  coord_df <- t(coord_matrix) |> "
"0","    as.data.frame() "
"0","  names(coord_df) <- c(""x"", ""y"")"
"0","  coord_df <- coord_df |>"
"0","    as_tibble() |>"
"0","    mutate("
"0","      transform = c(0, transform_index),"
"0","      iteration = row_number() - 1"
"0","    )"
"0","  return(coord_df)"
"0","}"
