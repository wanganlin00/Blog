[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "HomePage",
    "section": "",
    "text": "sina 图\n\n\n\n\n\n\ngraphics\n\n\nggplot2 extension\n\n\n\n\n\n\n\n\n\nNov 2, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nconda\n\n\n\n\n\n\nconfig\n\n\n\n\n\n\n\n\n\nNov 1, 2024\n\n\n\n\n\n\n\n\n\n\n\n\n森林图\n\n\n\n\n\n\nmeta\n\n\n\n\n\n\n\n\n\nOct 29, 2024\n\n\n\n\n\n\n\n\n\n\n\n\n研究间异质性\n\n\n\n\n\n\nmeta\n\n\n\n\n\n\n\n\n\nOct 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\n效应大小\n\n\n\n\n\n\nmeta\n\n\n\n\n\n\n\n\n\nOct 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\npooling effect sizes\n\n\n\n\n\n\nmeta\n\n\n\n\n\n\n\n\n\nOct 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\n睿客云盘\n\n\n\n\n\n\n\n\n\n\n\nOct 19, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nRprofile.site\n\n\n\n\n\n\nconfig\n\n\nR\n\n\n\n\n\n\n\n\n\nOct 19, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nPubMed retrieval\n\n\n\n\n\n\ndatabase\n\n\n\n\n\n\n\n\n\nOct 15, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nreal-time Reverse Transcription PCR\n\n\n\n\n\n\nprotocols\n\n\nPCR\n\n\nDNA\n\n\nRNA\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\npolymerase chain reaction (PCR)\n\n\n\n\n\n\nprotocols\n\n\nPCR\n\n\nDNA\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nimmunoprecipitation\n\n\n\n\n\n\nprotocols\n\n\nprotein\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nenzyme-linked immunosorbent assay (ELISA)\n\n\n\n\n\n\nprotocols\n\n\nprotein\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nPlasmid DNA purification,digestion and identification\n\n\n\n\n\n\nprotocols\n\n\nDNA\n\n\nplasmid\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nPeripheral Blood Mononuclear Cells: Isolation, Freezing, Thawing, and Culture\n\n\n\n\n\n\nprotocols\n\n\ncell\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nGene Konckout\n\n\n\n\n\n\nprotocols\n\n\nDNA\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nGene Konckdown\n\n\n\n\n\n\nprotocols\n\n\nDNA\n\n\nRNAi\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nFlow cytometry (FC)\n\n\n\n\n\n\nprotocols\n\n\ncell\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nCaCl2 Transformation of Escherichia coli\n\n\n\n\n\n\nprotocols\n\n\ncell\n\n\n\n\n\n\n\n\n\nOct 14, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nPropensity score matching\n\n\n\n\n\n\npropensity score\n\n\n\n\n\n\n\n\n\nOct 11, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nZotero\n\n\n\n\n\n\nZotero\n\n\n\n\n\n\n\n\n\nOct 9, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nggprism: GraphPad Prism 主题风格\n\n\n\n\n\n\ngraphics\n\n\nggplot2 extension\n\n\n\n\n\n\n\n\n\nSep 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nggpattern: ggplot2 with geometric texture amd images\n\n\n\n\n\n\ngraphics\n\n\nggplot2 extension\n\n\n\n\n\n\n\n\n\nSep 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nggforce: barplot with round angle\n\n\n\n\n\n\ngraphics\n\n\nggplot2 extension\n\n\n\n\n\n\n\n\n\nSep 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nWestern Blot\n\n\n\n\n\n\nprotocols\n\n\nprotein\n\n\n\n\n\n\n\n\n\nSep 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nUCSC\n\n\n\n\n\n\nbioinformatics\n\n\ndatabase\n\n\n\n\n\n\n\n\n\nSep 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nTCGA\n\n\n\n\n\n\nbioinformatics\n\n\ndatabase\n\n\n\n\n\n\n\n\n\nSep 24, 2024\n\n\n\n\n\n\n\n\n\n\n\n\niterated function system\n\n\n\n\n\n\ngraphics\n\n\nart\n\n\n\n\n\n\n\n\n\nSep 23, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nWelcome To My Blog\n\n\n\n\n\n\nwelcome\n\n\n\n\n\n\n\n\n\nSep 23, 2024\n\n\n\n\n\n\n\n\n\n\n\n\nSEER: The Surveillance, Epidemiology, and End Results Program\n\n\n\n\n\n\ndatabase\n\n\n\n\n\n\n\n\n\nSep 17, 2024\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/PropensityScore/PSM_NatureMethods.html",
    "href": "posts/PropensityScore/PSM_NatureMethods.html",
    "title": "Code from Nature Methods: Propensity score matching",
    "section": "",
    "text": "Propensity score matching (Nature Methods)\n\nShow the code# Simulate a study of bone density (bd) in a cohort of non-smokers and smokers.\n\ncohort_size = 1000\n\n# Bone density (bd) units g/cm^2 expressed as \"T score\" relative to young population. \n# https://www.researchgate.net/publication/259608747_Age-Related_Changes_in_the_Prevalence_of_Osteoporosis_according_to_Gender_and_Skeletal_Site_The_Korea_National_Health_and_Nutrition_Examination_Survey_2008-2010\n# https://www.chatswooddensitometry.com.au/bone-density-results.html\n# T = 0 corresponds to about 1.2 g/cm^2\n#\n#              -2.5         -1.0\n# &lt;--------------|------------|-----------&gt;\n#   osteoporosis   osteopenia   normal\n\nsmoking_bd_true_effect           = -0.5\nmax_individual_covariate_effect  = -0.5\n\n# \"treatment\" refers to membership in smoking group\n# covariate_effect - 0/1 - whether covariates impact bone density (for testing)\n# treatment_effect - 0/1 - whether smoking impacts bone density (for testing)\nmake_cohort = function(covariate_effect=0,treatment_effect=0,seed,n=cohort_size) {\nset.seed(seed)\nblood = tibble(\n  id      = 1:n,\n  #############################################################\n  # ALCOHOL\n  # g/day\n  # https://pophealthmetrics.biomedcentral.com/articles/10.1186/1478-7954-10-6/tables/2\n  # Distribution below from Table 2 (male, USA2)\n  # Min.  1st Qu.   Median     Mean  3rd Qu.     Max.    sd\n  # 0.0003   1.8410   7.5948  14.5125  19.2759 142.6630 19\n  alcohol = rgamma(cohort_size,scale=25.65,shape=0.53),\n  #############################################################\n  # STRESS\n  # perceived stress scale (PSS), 0-40\n  # https://www.slu.edu/medicine/family-medicine/pdfs/perceived-stress-scale.pdf\n  # Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    sd\n  # 0.5266  6.9912 11.6250 12.4698 16.8827 37.3044  7.0\n  stress_base  = bound(50*rbeta(cohort_size,2,6),c(0,40)),\n  #############################################################\n  # CAFFEINE\n  # mg/day\n  # https://www.ncbi.nlm.nih.gov/books/NBK202226/\n  # table 2-1 avg 165 90% 379\n  # Min.  1st Qu.  Median    Mean 3rd Qu.    Max.  90% \n  # 0.034  75.355 166.391 200.789 294.416 773.001  428\n  caffeine = 800*rbeta(cohort_size,1,3),\n) %&gt;% \n  mutate(\n         # +0.5 stress for each alcohol g/day (arbitrary increase)\n         # e.g. those in 75% of alcohol consumption drink 18 g/day = +9 stress ~ s.d. of stress distribution\n         alcohol_stress_effect = alcohol / 2,\n         stress = bound(stress_base + alcohol_stress_effect,c(0,40))) %&gt;%\n  mutate(bd_base             = rnorm(cohort_size,0,0.5),\n         bd_covariate_effect = max_individual_covariate_effect*(\n                                  rescale(stress,  to=c(0,1)) + \n                                  rescale(alcohol, to=c(0,1)) + \n                                  rescale(caffeine,to=c(0,1)))) %&gt;%\n  # Each covariate (arbitrarily) contributes equally to the treatment score\n  # based on subject's percentile value in the covariate's distribution.\n  # The score is then rescaled to a probability in the range [0,1], which is then used\n  # to generate assignment to control (treatment = 0) or treatment (treatment = 1) groups.\n  mutate(\n         treatment_score  = rescale(stress,  to=c(0,1)) + \n                            rescale(alcohol, to=c(0,1)) + \n                            rescale(caffeine,to=c(0,1)), \n         treatment_p      = rescale(treatment_score, to = c(0.1,0.9)),\n         treatment        = rbinom(cohort_size, 1, treatment_p)) %&gt;% \n  # Bone density\n  mutate(\n         # reduction in bd if subject is a smoker\n         bd_treatment_effect = treatment*smoking_bd_true_effect,\n         # final bd, including covariate effects (if toggled) and treatment effect (if toggled)\n         bd = bd_base + covariate_effect*bd_covariate_effect + treatment_effect*bd_treatment_effect)\n}\n\n# 1. Pick a seed\nseed = 20 \n# 2. Cohort A : no treatment or covariate effects\ncohort_a = make_cohort(seed=seed,covariate_effect=0,treatment_effect=0)\npsych::describeBy(stress + alcohol + caffeine + bd ~ treatment, data = cohort_a)\n\n\n Descriptive statistics by group \ntreatment: 0\n         vars   n   mean     sd median trimmed    mad   min    max  range skew\nstress      1 651  16.92   9.24  15.71   16.17   9.20  0.88  40.00  39.12 0.65\nalcohol     2 651  10.78  15.06   5.10    7.63   6.89  0.00 108.19 108.19 2.68\ncaffeine    3 651 180.24 145.66 140.32  163.46 144.68  0.22 693.09 692.87 0.89\nbd          4 651   0.03   0.51   0.03    0.03   0.53 -1.27   1.46   2.74 0.00\n         kurtosis   se\nstress      -0.10 0.36\nalcohol      9.34 0.59\ncaffeine     0.08 5.71\nbd          -0.36 0.02\n------------------------------------------------------------ \ntreatment: 1\n         vars   n   mean     sd median trimmed    mad   min    max  range  skew\nstress      1 349  21.46  10.47  20.48   21.18  12.20  0.62  40.00  39.38  0.21\nalcohol     2 349  18.47  23.38   9.47   13.97  12.96  0.00 142.97 142.97  2.30\ncaffeine    3 349 231.16 166.58 199.42  217.70 187.19  1.69 708.31 706.62  0.61\nbd          4 349   0.01   0.52  -0.02    0.01   0.56 -1.38   1.57   2.95 -0.01\n         kurtosis   se\nstress      -0.96 0.56\nalcohol      6.69 1.25\ncaffeine    -0.58 8.92\nbd          -0.27 0.03\n\nShow the code# 3. Cohort B : covariate effect, no treatment effect\ncohort_b = make_cohort(seed=seed,covariate_effect=1,treatment_effect=0)\npsych::describeBy(stress + alcohol + caffeine + bd ~ treatment, data = cohort_b)\n\n\n Descriptive statistics by group \ntreatment: 0\n         vars   n   mean     sd median trimmed    mad   min    max  range skew\nstress      1 651  16.92   9.24  15.71   16.17   9.20  0.88  40.00  39.12 0.65\nalcohol     2 651  10.78  15.06   5.10    7.63   6.89  0.00 108.19 108.19 2.68\ncaffeine    3 651 180.24 145.66 140.32  163.46 144.68  0.22 693.09 692.87 0.89\nbd          4 651  -0.34   0.55  -0.35   -0.34   0.59 -1.78   1.19   2.97 0.03\n         kurtosis   se\nstress      -0.10 0.36\nalcohol      9.34 0.59\ncaffeine     0.08 5.71\nbd          -0.28 0.02\n------------------------------------------------------------ \ntreatment: 1\n         vars   n   mean     sd median trimmed    mad   min    max  range  skew\nstress      1 349  21.46  10.47  20.48   21.18  12.20  0.62  40.00  39.38  0.21\nalcohol     2 349  18.47  23.38   9.47   13.97  12.96  0.00 142.97 142.97  2.30\ncaffeine    3 349 231.16 166.58 199.42  217.70 187.19  1.69 708.31 706.62  0.61\nbd          4 349  -0.48   0.57  -0.46   -0.48   0.61 -2.08   1.32   3.40 -0.01\n         kurtosis   se\nstress      -0.96 0.56\nalcohol      6.69 1.25\ncaffeine    -0.58 8.92\nbd          -0.19 0.03\n\nShow the code#hist(cohort$bp)\n# 4. Cohort C : covariate and treatment effects\ncohort_c = make_cohort(seed=seed,covariate_effect=1,treatment_effect=1)\npsych::describeBy(stress + alcohol + caffeine + bd ~ treatment, data = cohort_c)\n\n\n Descriptive statistics by group \ntreatment: 0\n         vars   n   mean     sd median trimmed    mad   min    max  range skew\nstress      1 651  16.92   9.24  15.71   16.17   9.20  0.88  40.00  39.12 0.65\nalcohol     2 651  10.78  15.06   5.10    7.63   6.89  0.00 108.19 108.19 2.68\ncaffeine    3 651 180.24 145.66 140.32  163.46 144.68  0.22 693.09 692.87 0.89\nbd          4 651  -0.34   0.55  -0.35   -0.34   0.59 -1.78   1.19   2.97 0.03\n         kurtosis   se\nstress      -0.10 0.36\nalcohol      9.34 0.59\ncaffeine     0.08 5.71\nbd          -0.28 0.02\n------------------------------------------------------------ \ntreatment: 1\n         vars   n   mean     sd median trimmed    mad   min    max  range  skew\nstress      1 349  21.46  10.47  20.48   21.18  12.20  0.62  40.00  39.38  0.21\nalcohol     2 349  18.47  23.38   9.47   13.97  12.96  0.00 142.97 142.97  2.30\ncaffeine    3 349 231.16 166.58 199.42  217.70 187.19  1.69 708.31 706.62  0.61\nbd          4 349  -0.98   0.57  -0.96   -0.98   0.61 -2.58   0.82   3.40 -0.01\n         kurtosis   se\nstress      -0.96 0.56\nalcohol      6.69 1.25\ncaffeine    -0.58 8.92\nbd          -0.19 0.03\n\nShow the code# Naive model that tests bp difference without accounting for covariates\nmeans  = cohort_c |&gt; group_by(treatment) |&gt; summarize(mean(bd))\neffect = as.numeric(means[2,2]-means[1,2])\neffect\n\n[1] -0.639786\n\nShow the code# Cohort A has no covariate or treatment effects. Both treated (smokers) and control (non-smokers)\n# should have the same distribution of bone density (bd)\np1 = ggplot() + geom_density(data=cohort_a |&gt; filter(treatment==T),aes(bd),color=palette[1]) +\n  geom_density(data=cohort_a |&gt; filter(treatment==F),aes(bd),color=\"black\") +\n  geom_vline(xintercept = cohort_a |&gt; filter(treatment==T) |&gt; select(bd) |&gt; as_vector() |&gt; mean(),color=palette[1]) +\n  geom_vline(xintercept = cohort_a |&gt; filter(treatment==F) |&gt; select(bd) |&gt; as_vector() |&gt; mean()) +\n  scale_x_continuous(lim=c(-2,2),breaks=seq(-2,2,by=0.5))\n\n# The magnitude of the covariate effect.\np2 = ggplot() + geom_density(data=cohort_b |&gt; filter(treatment==T),aes(bd_covariate_effect),color=palette[1]) +\n  geom_density(data=cohort_b |&gt; filter(treatment==F),aes(bd_covariate_effect),color=\"black\") +\n  geom_vline(xintercept = cohort_b |&gt; filter(treatment==T) |&gt; select(bd_covariate_effect) |&gt; as_vector() |&gt; mean(),color=palette[1]) +\n  geom_vline(xintercept = cohort_b |&gt; filter(treatment==F) |&gt; select(bd_covariate_effect) |&gt; as_vector() |&gt; mean()) +\n  scale_x_continuous(lim=c(-2,2),breaks=seq(-2,2,by=0.5))\n\n# Treatment probability.\np2b = ggplot() + geom_density(data=cohort_b |&gt; filter(treatment==T),aes(treatment_p),color=palette[1]) +\n  geom_density(data=cohort_b |&gt; filter(treatment==F),aes(treatment_p),color=\"black\") +\n  geom_vline(xintercept = cohort_b |&gt; filter(treatment==T) |&gt; select(treatment_p) |&gt; as_vector() |&gt; mean(),color=palette[1]) +\n  geom_vline(xintercept = cohort_b |&gt; filter(treatment==F) |&gt; select(treatment_p) |&gt; as_vector() |&gt; mean()) +\n  scale_x_continuous(lim=c(0,1),breaks=seq(0,1,by=.2))\n  \n# Cohort B : covariate effect but no treatment effect\np3 = ggplot() + geom_density(data=cohort_b |&gt; filter(treatment==T),aes(bd),color=palette[1]) +\n  geom_density(data=cohort_b |&gt; filter(treatment==F),aes(bd),color=\"black\") +\n  geom_vline(xintercept = cohort_b |&gt; filter(treatment==T) |&gt; select(bd) |&gt; as_vector() |&gt; mean(),color=palette[1]) +\n  geom_vline(xintercept = cohort_b |&gt; filter(treatment==F) |&gt; select(bd) |&gt; as_vector() |&gt; mean()) +\n  scale_x_continuous(lim=c(-2,2),breaks=seq(-2,2,by=0.5))\n\n# Cohort B : covariate and treatment effect\np4 = ggplot() + geom_density(data=cohort_c |&gt; filter(treatment==T),aes(bd),color=palette[1]) +\n  geom_density(data=cohort_c |&gt; filter(treatment==F),aes(bd),color=\"black\") +\n  geom_vline(xintercept = cohort_c |&gt; filter(treatment==T) |&gt; select(bd) |&gt; as_vector() |&gt; mean(),color=palette[1]) +\n  geom_vline(xintercept = cohort_c |&gt; filter(treatment==F) |&gt; select(bd) |&gt; as_vector() |&gt; mean()) +\n  scale_x_continuous(lim=c(-2,2),breaks=seq(-2,2,by=0.5))\n\nmultiplot(plot_theme(p1,aspect),plot_theme(p2,aspect),plot_theme(p2b,aspect),plot_theme(p3,aspect),plot_theme(p4,aspect),cols=1)\n\n\n\n\n\n\nShow the codedev.copy2pdf(file = \"fig-distributions.pdf\",useDingbats=FALSE,width=5,height=3)\n\npng \n  2 \n\nShow the codecohort        = cohort_c\nmodel_matched = lm(bd ~ treatment, \n                    data = cohort_c)\nsummary(model_matched)\n\n\nCall:\nlm(formula = bd ~ treatment, data = cohort_c)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.60017 -0.40313  0.00176  0.39403  1.80181 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.34018    0.02179  -15.61   &lt;2e-16 ***\ntreatment   -0.63979    0.03689  -17.34   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.556 on 998 degrees of freedom\nMultiple R-squared:  0.2316,    Adjusted R-squared:  0.2309 \nF-statistic: 300.9 on 1 and 998 DF,  p-value: &lt; 2.2e-16\n\n\n\nShow the code# propensity score matching with replacement\nmatched_data = matchit(treatment ~ alcohol + stress + caffeine,\n                        data     = cohort,\n                        method   = \"nearest\",\n                        replace  = TRUE,\n                        caliper  = 0.1)\n\ncohort$w   = matched_data$weights\ncohort$ps  = matched_data$distance\ncohort$cat = 0\n\ncohort[cohort$w == 0 & cohort$treatment==F,]$cat=-2  # unmatched control\ncohort[cohort$w == 0 & cohort$treatment==T,]$cat=-1  # unmatched treat\ncohort[cohort$w &gt; 0  & cohort$treatment==F,]$cat=0   # matched   control\ncohort[cohort$w &gt; 0  & cohort$treatment==T,]$cat=1   # matched   treat\ncohort |&gt; count(cat)\n\n# A tibble: 4 × 2\n    cat     n\n  &lt;dbl&gt; &lt;int&gt;\n1    -2   416\n2    -1     5\n3     0   235\n4     1   344\n\n\n\nShow the codeaspect = 1/3 # for plots\n\n# full cohort\n# plot densities of alcohol, stress, caffine\n\nvarT = cohort|&gt;filter(treatment==T)|&gt;select(alcohol)\nvarF = cohort|&gt;filter(treatment==F)|&gt;select(alcohol)\np1 = ggplot() + \n    geom_density(data=varF,aes(alcohol),color=\"black\",size=1) +\n    geom_density(data=varT,aes(alcohol),color=palette[1],size=1) +\n    geom_vline(xintercept=varF|&gt;as_vector()|&gt;mean(),color=\"black\") +\n    geom_vline(xintercept=varT|&gt;as_vector()|&gt;mean(),color=palette[1]) +\n    annotate(\"text\",x=varF|&gt;as_vector()|&gt;mean()-1,y=0,label=varF|&gt;as_vector()|&gt;mean()|&gt;round(1),color=\"black\",size=3,hjust=1) +\n    annotate(\"text\",x=varT|&gt;as_vector()|&gt;mean()+1,y=0,label=varT|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[1],size=3,hjust=0) +\n  scale_x_continuous(lim=c(0,100)) +\n  scale_y_continuous(lim=c(0,0.1))\n\nvarT = cohort|&gt;filter(treatment==T)|&gt;select(stress)\nvarF = cohort|&gt;filter(treatment==F)|&gt;select(stress)\np2 = ggplot() + \n    geom_density(data=varF,aes(stress),color=\"black\",size=1) +\n    geom_density(data=varT,aes(stress),color=palette[1],size=1) +\n    geom_vline(xintercept=varF|&gt;as_vector()|&gt;mean(),color=\"black\") +\n    geom_vline(xintercept=varT|&gt;as_vector()|&gt;mean(),color=palette[1]) +\n    annotate(\"text\",x=varF|&gt;as_vector()|&gt;mean()-5,y=0,label=varF|&gt;as_vector()|&gt;mean()|&gt;round(1),color=\"black\",size=3,hjust=1) +\n    annotate(\"text\",x=varT|&gt;as_vector()|&gt;mean()+5,y=0,label=varT|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[1],size=3,hjust=0) +\n  scale_x_continuous(lim=c(0,40)) +\n  scale_y_continuous(lim=c(0,0.06))\n\nvarT = cohort|&gt;filter(treatment==T)|&gt;select(caffeine)\nvarF = cohort|&gt;filter(treatment==F)|&gt;select(caffeine)\np3 = ggplot() + \n    geom_density(data=varF,aes(caffeine),color=\"black\",size=1) +\n    geom_density(data=varT,aes(caffeine),color=palette[1],size=1) +\n    geom_vline(xintercept=varF|&gt;as_vector()|&gt;mean(),color=\"black\") +\n    geom_vline(xintercept=varT|&gt;as_vector()|&gt;mean(),color=palette[1]) +\n    annotate(\"text\",x=varF|&gt;as_vector()|&gt;mean()-1,y=0,label=varF|&gt;as_vector()|&gt;mean()|&gt;round(1),color=\"black\",size=3,hjust=1) +\n    annotate(\"text\",x=varT|&gt;as_vector()|&gt;mean()+1,y=0,label=varT|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[1],size=3,hjust=0) + \n    scale_x_continuous(lim=c(0,400),breaks=seq(0,400,by=50)) +\n    scale_y_continuous(lim=c(0,0.006))\n\nmultiplot(plot_theme(p1,aspect),plot_theme(p2,aspect),plot_theme(p3,aspect),cols=1)\n\n\n\n\n\n\nShow the codedev.copy2pdf(file = \"fig2a.pdf\",useDingbats=FALSE,width=5,height=3)\n\npng \n  2 \n\nShow the code# matched/unmatched\n# plot densities of alcohol, cholesterol, caffeine\n\nvarT   = cohort[matched_data$weights&gt;0,]|&gt;filter(treatment==T)|&gt;select(alcohol)\nvarF   = cohort[matched_data$weights&gt;0,]|&gt;filter(treatment==F)|&gt;select(alcohol)\nvarFun = cohort[matched_data$weights==0,]|&gt;filter(treatment==F)|&gt;select(alcohol)\np1 = ggplot() + \n    geom_density(data=varF,aes(alcohol),color=\"black\",size=1) +\n    geom_density(data=varT,aes(alcohol),color=palette[1],size=1) +\n    geom_density(data=varFun,aes(alcohol),color=palette[2],size=1) +\n    geom_vline(xintercept=varF|&gt;as_vector()|&gt;mean(),color=\"black\") +\n    geom_vline(xintercept=varT|&gt;as_vector()|&gt;mean(),color=palette[1]) +\n    geom_vline(xintercept=varFun|&gt;as_vector()|&gt;mean(),color=palette[2]) +\n    annotate(\"text\",x=varF|&gt;as_vector()|&gt;mean()-1,y=0,label=varF|&gt;as_vector()|&gt;mean()|&gt;round(1),color=\"black\",size=3,hjust=1) +\n    annotate(\"text\",x=varFun|&gt;as_vector()|&gt;mean()-1,y=0,label=varFun|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[2],size=3,hjust=1) +\n    annotate(\"text\",x=varT|&gt;as_vector()|&gt;mean()+1,y=0,label=varT|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[1],size=3,hjust=0) +\n  scale_x_continuous(lim=c(0,100)) +\n  scale_y_continuous(lim=c(0,0.1))\n\nvarT   = cohort[matched_data$weights&gt;0,]|&gt;filter(treatment==T)|&gt;select(stress)\nvarF   = cohort[matched_data$weights&gt;0,]|&gt;filter(treatment==F)|&gt;select(stress)\nvarFun = cohort[matched_data$weights==0,]|&gt;filter(treatment==F)|&gt;select(stress)\np2 = ggplot() + \n    geom_density(data=varF,aes(stress),color=\"black\",size=1) +\n    geom_density(data=varT,aes(stress),color=palette[1],size=1) +\n    geom_density(data=varFun,aes(stress),color=palette[2],size=1) +\n    geom_vline(xintercept=varF|&gt;as_vector()|&gt;mean(),color=\"black\") +\n    geom_vline(xintercept=varT|&gt;as_vector()|&gt;mean(),color=palette[1]) +\n    geom_vline(xintercept=varFun|&gt;as_vector()|&gt;mean(),color=palette[2]) +\n    annotate(\"text\",x=varF|&gt;as_vector()|&gt;mean()-1,y=0,label=varF|&gt;as_vector()|&gt;mean()|&gt;round(1),color=\"black\",size=3,hjust=1) +\n    annotate(\"text\",x=varFun|&gt;as_vector()|&gt;mean()-1,y=0,label=varFun|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[2],size=3,hjust=1) +\n    annotate(\"text\",x=varT|&gt;as_vector()|&gt;mean()+1,y=0,label=varT|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[1],size=3,hjust=0) +\n  scale_x_continuous(lim=c(0,40)) +\n  scale_y_continuous(lim=c(0,0.06))\n\nvarT   = cohort[matched_data$weights&gt;0,]|&gt;filter(treatment==T)|&gt;select(caffeine)\nvarF   = cohort[matched_data$weights&gt;0,]|&gt;filter(treatment==F)|&gt;select(caffeine)\nvarFun = cohort[matched_data$weights==0,]|&gt;filter(treatment==F)|&gt;select(caffeine)\np3 = ggplot() + \n    geom_density(data=varF,aes(caffeine),color=\"black\",size=1) +\n    geom_density(data=varT,aes(caffeine),color=palette[1],size=1) +\n    geom_density(data=varFun,aes(caffeine),color=palette[2],size=1) +\n    geom_vline(xintercept=varF|&gt;as_vector()|&gt;mean(),color=\"black\") +\n    geom_vline(xintercept=varT|&gt;as_vector()|&gt;mean(),color=palette[1]) +\n    geom_vline(xintercept=varFun|&gt;as_vector()|&gt;mean(),color=palette[2]) +\n    annotate(\"text\",x=varF|&gt;as_vector()|&gt;mean()-1,y=0,label=varF|&gt;as_vector()|&gt;mean()|&gt;round(1),color=\"black\",size=3,hjust=1) +\n    annotate(\"text\",x=varFun|&gt;as_vector()|&gt;mean()-1,y=0,label=varFun|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[2],size=3,hjust=1) +\n    annotate(\"text\",x=varT|&gt;as_vector()|&gt;mean()+1,y=0,label=varT|&gt;as_vector()|&gt;mean()|&gt;round(1),color=palette[1],size=3,hjust=0) +\n    scale_x_continuous(lim=c(0,400),breaks=seq(0,400,by=50)) +\n    scale_y_continuous(lim=c(0,0.006))\n\nmultiplot(plot_theme(p1,aspect),plot_theme(p2,aspect),plot_theme(p3,aspect),cols=1)\n\n\n\n\n\n\nShow the codedev.copy2pdf(file = \"fig2b.pdf\",useDingbats=FALSE,width=5,height=3)\n\npng \n  2 \n\n\n\nShow the codepdf(\"fig3a.pdf\")\nplot(matched_data, type = \"jitter\", interactive = FALSE)\ndev.off()\n\npng \n  2 \n\nShow the codepdf(\"fig3b.pdf\")\nlove.plot(matched_data, binary = \"std\")\ndev.off()\n\npng \n  2 \n\n\n\nShow the code# get the matched data set\nmatched_data_for_real = match.data(matched_data)\nmatched_data_for_real |&gt; nrow()\n\n[1] 579\n\nShow the code# new linear model with matched data\nmodel_matched = lm(bd ~ treatment, \n                    data = matched_data_for_real)\nsummary(model_matched)\n\n\nCall:\nlm(formula = bd ~ treatment, data = matched_data_for_real)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.6067 -0.3913  0.0018  0.3920  1.7953 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.42417    0.03647  -11.63   &lt;2e-16 ***\ntreatment   -0.54927    0.04732  -11.61   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5591 on 577 degrees of freedom\nMultiple R-squared:  0.1893,    Adjusted R-squared:  0.1879 \nF-statistic: 134.7 on 1 and 577 DF,  p-value: &lt; 2.2e-16\n\nShow the code# get the same result by comparing means\nmatched_data_for_real |&gt;\n  filter(treatment==T) |&gt;\n  summarize(blood_mean=mean(bd)) -\n  matched_data_for_real |&gt;\n  filter(treatment==F) |&gt;\n  summarize(blood_mean=mean(bd))\n\n  blood_mean\n1 -0.5492713\n\n\n\nShow the code# jitter plot of unmatched data (entire cohort)\nbd_min = -3\nbd_max = 1.5\np1 = ggplot(cohort, aes(x=treatment, y=bd)) +  \n  geom_jitter(width=0.2,shape=16,size=0.5) +\n  stat_summary(fun = \"mean\", geom = \"crossbar\", width = .5, color = \"orange\") +\n  annotate(\"text\", x = 0.25, y = 0, hjust=0,size=3,label = cohort |&gt; \n             filter(treatment==F) |&gt; \n             select(bd) |&gt; as_vector() |&gt; mean() |&gt; round(2)) +\n  annotate(\"text\", x = 1.25, y = 0, hjust=0,size=3,label = cohort |&gt; \n             filter(treatment==T) |&gt; \n             select(bd) |&gt; as_vector() |&gt; mean() |&gt; round(2)) +\n  scale_x_continuous(lim=c(-2.25,1.75))  +\n  scale_y_continuous(lim=c(bd_min,bd_max),breaks=seq(bd_min,bd_max,by=1))\n# jitter plot of matched data \np2 = ggplot(cohort, aes(x=cat, y=bd)) +  \n  geom_jitter(width=0.2,shape=16,size=0.5) +\n  stat_summary(fun = \"mean\", geom = \"crossbar\", width = .5, color = \"orange\") +\n  annotate(\"text\",x=-1.75,y=0,hjust=0,size=3,\n             label=cohort|&gt;filter(cat==-2)|&gt;select(bd) |&gt; as_vector() |&gt; mean() |&gt; round(1)) +\n  annotate(\"text\",x=-0.75,y=0,hjust=0,size=3,\n             label=cohort|&gt;filter(cat==-1)|&gt;select(bd) |&gt; as_vector() |&gt; mean() |&gt; round(2)) +\n  annotate(\"text\",x=0.25,y=0,hjust=0,size=3,\n             label=cohort|&gt;filter(cat==0)|&gt;select(bd) |&gt; as_vector() |&gt; mean() |&gt; round(2)) +\n  annotate(\"text\",x=1.25,y=0,hjust=0,size=3,\n             label=cohort|&gt;filter(cat==1)|&gt;select(bd) |&gt; as_vector() |&gt; mean() |&gt; round(2)) +\n  scale_x_continuous(lim=c(-2.25,1.75)) +\n  scale_y_continuous(lim=c(bd_min,bd_max),breaks=seq(bd_min,bd_max,by=1))\n\n# linear model with weights\nmodel_matched_wts = lm(bd ~ treatment, \n                        data = matched_data_for_real,\n                        weights = weights)\nsummary(model_matched_wts)\n\n\nCall:\nlm(formula = bd ~ treatment, data = matched_data_for_real, weights = weights)\n\nWeighted Residuals:\n     Min       1Q   Median       3Q      Max \n-1.93615 -0.36786  0.01487  0.37422  1.79528 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.45059    0.03663   -12.3   &lt;2e-16 ***\ntreatment   -0.52286    0.04753   -11.0   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5616 on 577 degrees of freedom\nMultiple R-squared:  0.1734,    Adjusted R-squared:  0.1719 \nF-statistic:   121 on 1 and 577 DF,  p-value: &lt; 2.2e-16\n\nShow the codedata = matched_data_for_real \n# plot\nwmean_f = as.numeric(data|&gt;filter(treatment==F)|&gt;select(bd, weights) |&gt; summarize(weighted_mean=weighted.mean(bd, weights)))\nwmean_t = as.numeric(data|&gt;filter(treatment==T)|&gt;select(bd, weights) |&gt; summarize(weighted_mean=weighted.mean(bd, weights)))\np3 = ggplot(data, aes(x=treatment, y=bd)) +  \n  geom_jitter(width=0.2,shape=16,size=scales::rescale(matched_data_for_real$weights, to=c(0.25, 1.25))) +\n  annotate(\"segment\",x=-0.25,y = as.numeric(wmean_f), xend=0.25, yend = as.numeric(wmean_f), color=\"orange\")+\n  annotate(\"segment\",x=0.75,y = as.numeric(wmean_t), xend=1.25, yend = as.numeric(wmean_t), color=\"orange\")+\n  annotate(\"text\",x=0.25,y=wmean_f,hjust=0,size=3,label=wmean_f |&gt; round(2)) +\n  annotate(\"text\",x=1.25,y=wmean_t,hjust=0,size=3,label=wmean_t |&gt; round(2)) +\n  scale_x_continuous(lim=c(-2.25,1.75)) +\n  scale_y_continuous(lim=c(bd_min,bd_max),breaks=seq(bd_min,bd_max,by=1))\n\naspect = 1\nmultiplot(plot_theme(p1,aspect),plot_theme(p2,aspect),plot_theme(p3,aspect),cols=3)\n\n\n\n\n\n\nShow the codedev.copy2pdf(file = \"fig4.pdf\",useDingbats=FALSE,width=5,height=2)\n\npng \n  2 \n\nShow the codemodel_matched_wts\n\n\nCall:\nlm(formula = bd ~ treatment, data = matched_data_for_real, weights = weights)\n\nCoefficients:\n(Intercept)    treatment  \n    -0.4506      -0.5229  \n\n\n\n\n[1] 323\n\n\n\nCall:\nlm(formula = bd ~ treatment, data = matched_data_noreplace_for_real)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.62875 -0.39014 -0.01118  0.38694  1.77323 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.41094    0.03063  -13.42   &lt;2e-16 ***\ntreatment   -0.54045    0.04331  -12.48   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5504 on 644 degrees of freedom\nMultiple R-squared:  0.1947,    Adjusted R-squared:  0.1934 \nF-statistic: 155.7 on 1 and 644 DF,  p-value: &lt; 2.2e-16\n\n\npng \n  2 \n\n\npng \n  2 \n\n\n# A tibble: 4 × 2\n    cat     n\n  &lt;dbl&gt; &lt;int&gt;\n1    -2   328\n2    -1    26\n3     0   323\n4     1   323\n\n\n\nShow the code# mahalanobis matching, not used \nmaha_matched = matchit(treatment ~ alcohol + stress + caffeine,\n                                              data = cohort,\n           distance = \"mahalanobis\", replace = TRUE)\nmatched_data_maha = match.data(maha_matched)\nmodel_maha_matched = lm(bd ~ treatment, \n                    data = matched_data_maha)\nsummary(model_maha_matched)\n\n\nCall:\nlm(formula = bd ~ treatment, data = matched_data_maha)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.60017 -0.39327 -0.01058  0.38729  1.80181 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.41493    0.03641  -11.39   &lt;2e-16 ***\ntreatment   -0.56504    0.04710  -12.00   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5582 on 582 degrees of freedom\nMultiple R-squared:  0.1982,    Adjusted R-squared:  0.1969 \nF-statistic: 143.9 on 1 and 582 DF,  p-value: &lt; 2.2e-16\n\n\n\nShow the code# propensity score matching with replacement\neffect_by_caliper = function(caliper=0.1,replace=TRUE) {\nmatched_data = matchit(treatment ~ alcohol + stress + caffeine,\n                        data     = cohort,\n                        method   = \"nearest\",\n                        replace  = replace,\n                        caliper  = caliper)\n# get the matched data set\nmatched_data_for_real = match.data(matched_data)\nn = matched_data_for_real |&gt; filter(treatment==T) |&gt; filter(weights&gt;0) |&gt; nrow()\nd = matched_data_for_real |&gt;\n    filter(treatment==T) |&gt;\n    summarize(bd_mean=mean(bd)) -\n    matched_data_for_real |&gt;\n    filter(treatment==F) |&gt;\n    summarize(bd_mean=mean(bd))\nreturn(c(n=as.numeric(n),d=as.numeric(d)))\n}\ncalipers   = seq(0.01,1,by=0.01)\neffects_r  = sapply(calipers,FUN=effect_by_caliper,replace=TRUE)\neffects_nr = sapply(calipers,FUN=effect_by_caliper,replace=FALSE)\np1 = ggplot(data=data.frame(x=calipers,yr=effects_r[1,],ynr=effects_nr[1,])) + geom_line(aes(x=x,y=yr)) + geom_line(aes(x=x,y=ynr),color=\"brown\")\np2 = ggplot(data=data.frame(x=calipers,yr=effects_r[2,],ynr=effects_nr[2,])) + geom_line(aes(x=x,y=yr)) + geom_line(aes(x=x,y=ynr),color=\"brown\")\nmultiplot(plot_theme(p1,aspect),plot_theme(p2,aspect),cols=2)\n\n\n\n\n\n\nShow the codedev.copy2pdf(file = \"fig5.pdf\",useDingbats=FALSE,width=6,height=3)\n\npng \n  2"
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To My Blog",
    "section": "",
    "text": "This is the first post.Welcome!"
  },
  {
    "objectID": "posts/TCGA/TCGA.html",
    "href": "posts/TCGA/TCGA.html",
    "title": "TCGA",
    "section": "",
    "text": "https://portal.gdc.cancer.gov/\nhttps://www.jingege.wang/2024/02/25/tcga-gdc-data-portal-2-0/\nhttps://www.jingege.wang/2022/07/16/tcgar/\n\nShow the codelibrary(jsonlite)\n\njson &lt;- jsonlite::fromJSON(\"data/metadata.cart.2024-07-04.json\") |&gt; as_tibble()\n\njson |&gt; select(associated_entities)\n\n# A tibble: 536 × 1\n   associated_entities\n   &lt;list&gt;             \n 1 &lt;df [1 × 4]&gt;       \n 2 &lt;df [1 × 4]&gt;       \n 3 &lt;df [1 × 4]&gt;       \n 4 &lt;df [1 × 4]&gt;       \n 5 &lt;df [1 × 4]&gt;       \n 6 &lt;df [1 × 4]&gt;       \n 7 &lt;df [1 × 4]&gt;       \n 8 &lt;df [1 × 4]&gt;       \n 9 &lt;df [1 × 4]&gt;       \n10 &lt;df [1 × 4]&gt;       \n# ℹ 526 more rows\n\nShow the codejson$associated_entities[[1]]\n\n           entity_submitter_id entity_type                              case_id\n1 TCGA-38-7271-01A-11R-2039-07     aliquot 8214a0d1-5e2d-4a7a-acb1-e5580755db83\n                             entity_id\n1 8d895d3d-9598-459b-813e-3fc84dd3efe8\n\nShow the code# sample_id &lt;- map_vec(json$associated_entities,~ .x[,1])\nsample_id &lt;- sapply(json$associated_entities,function(x){x[,1]})\n\n\nfile_sample &lt;- tibble(sample_id,file_name=json$file_name) \n\n\n\nShow the code#获取gdc_download文件夹下的所有TSV表达文件的 路径+文件名\ncount_file &lt;- list.files(\"data/gdc_download_20240704_131631.625023\",pattern = \"*.tsv\",recursive = TRUE)\n#在count_file中分割出文件名\ncount_file_name &lt;- str_split(count_file,pattern = '/') \n\ncount_file_name &lt;- sapply(count_file_name,function(x){x[2]})\n\n\n\n\nShow the codematrix = data.frame(matrix(nrow=60660,ncol=0))\n\n\nfor (i in 1:length(count_file)) {\n    path = paste0('data/gdc_download_20240704_131631.625023/',\n                  count_file[i])\n    data &lt;- read_tsv(path, col_names = T, skip = 1)\n    data &lt;- data[-c(1:4), c(1, 4)] |&gt; column_to_rownames(var = \"gene_id\")  #取出ESEMBL_id列1 和 unstranded列 4，即count数据，对应其它数据，第2列为gene symbol\n    colnames(data) &lt;- file_sample$sample_id[which(file_sample$file_name == count_file_name[i])]\n    \n    matrix &lt;- cbind(matrix, data)\n}\nwrite.csv(matrix,'data/COUNT_matrix.csv',row.names = TRUE)\n\n\n\n根据TCGA样本的命名可以区分正常组织和肿瘤样本的测序结果 其中 14、15位置编号大于10 表示正常\n\nShow the codeCOUNT_matrix &lt;- read_csv('data/COUNT_matrix.csv') |&gt; column_to_rownames(var = \"...1\")\n\n\nstr_sub(colnames(COUNT_matrix),14,15) |&gt; table()\n\n\n 01  02  11 \n481   2  53 \n\n\n\n\nShow the codejson &lt;- jsonlite::fromJSON(\"data/metadata.cart.2024-07-04.json\")\n\nentity_submitter_id &lt;- sapply(json$associated_entities,function(x){x[,1]})\ncase_id &lt;- sapply(json$associated_entities,function(x){x[,3]})\nsample_case &lt;- t(rbind(entity_submitter_id,case_id)) |&gt; as_tibble()\n\nclinical &lt;- read.delim('data/clinical.cart.2024-07-04/clinical.tsv',header = T)\n\nclinical &lt;- clinical |&gt; distinct(case_id,.keep_all = TRUE)\n\n\n\n\n\nclinical_matrix &lt;- left_join(sample_case,clinical,by = join_by(case_id))\n\nclinical_matrix &lt;- clinical_matrix |&gt; select(-case_id)\n\n\n\n\nShow the codejson &lt;- jsonlite::fromJSON(\"metadata.cart.2022-09-27.json\")\n\n#id &lt;- json$associated_entities[[1]][,1]\nsample_id &lt;- sapply(json$associated_entities,function(x){x[,1]})\nfile_sample &lt;- data.frame(sample_id,file_name=json$file_name)  \n\n#获取gdc_download文件夹下的所有miRNA表达文件的 路径+文件名\ncount_file &lt;- list.files('gdc_download_20220927_150057.906231',pattern = '*quantification.txt',recursive = TRUE)\n#在count_file中分割出文件名\ncount_file_name &lt;- strsplit(count_file,split='/')\ncount_file_name &lt;- sapply(count_file_name,function(x){x[2]})\n\nmatrix = data.frame(matrix(nrow=1881,ncol=0))\nfor (i in 1:length(count_file)){\n  path = paste0('gdc_download_20220927_150057.906231//',count_file[i])\n  data&lt;- read.delim(path,fill = TRUE,header = T,row.names = 1)\n  data &lt;- data[1]   #取出count列（第1列），rpm列（第2列）\n  colnames(data) &lt;- file_sample$sample_id[which(file_sample$file_name==count_file_name[i])]\n  matrix &lt;- cbind(matrix,data)\n}\n\n\n\nhttps://bioconductor.org/packages/release/workflows/html/TCGAWorkflow.html"
  },
  {
    "objectID": "posts/TCGA/TCGA.html#计数矩阵",
    "href": "posts/TCGA/TCGA.html#计数矩阵",
    "title": "TCGA",
    "section": "",
    "text": "Show the codematrix = data.frame(matrix(nrow=60660,ncol=0))\n\n\nfor (i in 1:length(count_file)) {\n    path = paste0('data/gdc_download_20240704_131631.625023/',\n                  count_file[i])\n    data &lt;- read_tsv(path, col_names = T, skip = 1)\n    data &lt;- data[-c(1:4), c(1, 4)] |&gt; column_to_rownames(var = \"gene_id\")  #取出ESEMBL_id列1 和 unstranded列 4，即count数据，对应其它数据，第2列为gene symbol\n    colnames(data) &lt;- file_sample$sample_id[which(file_sample$file_name == count_file_name[i])]\n    \n    matrix &lt;- cbind(matrix, data)\n}\nwrite.csv(matrix,'data/COUNT_matrix.csv',row.names = TRUE)"
  },
  {
    "objectID": "posts/TCGA/TCGA.html#normal-和-tumor",
    "href": "posts/TCGA/TCGA.html#normal-和-tumor",
    "title": "TCGA",
    "section": "",
    "text": "根据TCGA样本的命名可以区分正常组织和肿瘤样本的测序结果 其中 14、15位置编号大于10 表示正常\n\nShow the codeCOUNT_matrix &lt;- read_csv('data/COUNT_matrix.csv') |&gt; column_to_rownames(var = \"...1\")\n\n\nstr_sub(colnames(COUNT_matrix),14,15) |&gt; table()\n\n\n 01  02  11 \n481   2  53"
  },
  {
    "objectID": "posts/TCGA/TCGA.html#表型矩阵",
    "href": "posts/TCGA/TCGA.html#表型矩阵",
    "title": "TCGA",
    "section": "",
    "text": "Show the codejson &lt;- jsonlite::fromJSON(\"data/metadata.cart.2024-07-04.json\")\n\nentity_submitter_id &lt;- sapply(json$associated_entities,function(x){x[,1]})\ncase_id &lt;- sapply(json$associated_entities,function(x){x[,3]})\nsample_case &lt;- t(rbind(entity_submitter_id,case_id)) |&gt; as_tibble()\n\nclinical &lt;- read.delim('data/clinical.cart.2024-07-04/clinical.tsv',header = T)\n\nclinical &lt;- clinical |&gt; distinct(case_id,.keep_all = TRUE)\n\n\n\n\n\nclinical_matrix &lt;- left_join(sample_case,clinical,by = join_by(case_id))\n\nclinical_matrix &lt;- clinical_matrix |&gt; select(-case_id)"
  },
  {
    "objectID": "posts/TCGA/TCGA.html#mirna-计数矩阵",
    "href": "posts/TCGA/TCGA.html#mirna-计数矩阵",
    "title": "TCGA",
    "section": "",
    "text": "Show the codejson &lt;- jsonlite::fromJSON(\"metadata.cart.2022-09-27.json\")\n\n#id &lt;- json$associated_entities[[1]][,1]\nsample_id &lt;- sapply(json$associated_entities,function(x){x[,1]})\nfile_sample &lt;- data.frame(sample_id,file_name=json$file_name)  \n\n#获取gdc_download文件夹下的所有miRNA表达文件的 路径+文件名\ncount_file &lt;- list.files('gdc_download_20220927_150057.906231',pattern = '*quantification.txt',recursive = TRUE)\n#在count_file中分割出文件名\ncount_file_name &lt;- strsplit(count_file,split='/')\ncount_file_name &lt;- sapply(count_file_name,function(x){x[2]})\n\nmatrix = data.frame(matrix(nrow=1881,ncol=0))\nfor (i in 1:length(count_file)){\n  path = paste0('gdc_download_20220927_150057.906231//',count_file[i])\n  data&lt;- read.delim(path,fill = TRUE,header = T,row.names = 1)\n  data &lt;- data[1]   #取出count列（第1列），rpm列（第2列）\n  colnames(data) &lt;- file_sample$sample_id[which(file_sample$file_name==count_file_name[i])]\n  matrix &lt;- cbind(matrix,data)\n}"
  },
  {
    "objectID": "posts/TCGA/TCGA.html#tcgaworkflow",
    "href": "posts/TCGA/TCGA.html#tcgaworkflow",
    "title": "TCGA",
    "section": "",
    "text": "https://bioconductor.org/packages/release/workflows/html/TCGAWorkflow.html"
  },
  {
    "objectID": "posts/UCSC/UCSC.html",
    "href": "posts/UCSC/UCSC.html",
    "title": "UCSC",
    "section": "",
    "text": "UCSC\nrtracklayer\n\nShow the codelibrary(rtracklayer)\nlibrary(AnnotationHub)\n\n# 第一次下载  ah &lt;- AnnotationHub()\nah &lt;- AnnotationHub()\n\n\n\nShow the codeah\n\nAnnotationHub with 71634 records\n# snapshotDate(): 2024-04-30\n# $dataprovider: Ensembl, BroadInstitute, UCSC, ftp://ftp.ncbi.nlm.nih.gov/g...\n# $species: Homo sapiens, Mus musculus, Drosophila melanogaster, Rattus norv...\n# $rdataclass: GRanges, TwoBitFile, BigWigFile, EnsDb, Rle, OrgDb, SQLiteFil...\n# additional mcols(): taxonomyid, genome, description,\n#   coordinate_1_based, maintainer, rdatadateadded, preparerclass, tags,\n#   rdatapath, sourceurl, sourcetype \n# retrieve records with, e.g., 'object[[\"AH5012\"]]' \n\n             title                                             \n  AH5012   | Chromosome Band                                   \n  AH5013   | STS Markers                                       \n  AH5014   | FISH Clones                                       \n  AH5015   | Recomb Rate                                       \n  AH5016   | ENCODE Pilot                                      \n  ...        ...                                               \n  AH117051 | Ensembl 112 EnsDb for Xiphophorus maculatus       \n  AH117052 | Ensembl 112 EnsDb for Xenopus tropicalis          \n  AH117053 | Ensembl 112 EnsDb for Zonotrichia albicollis      \n  AH117054 | Ensembl 112 EnsDb for Zalophus californianus      \n  AH117055 | Ensembl 112 EnsDb for Zosterops lateralis melanops\n\nShow the code# C:/Users/DELL/AppData/Local/R/cache/R/AnnotationHub/\n\n\n\nShow the codeOrgDb_Human &lt;- subset(ah, rdataclass == \"OrgDb\" & species == \"Homo sapiens\")\nOrgDb_Human\n\nAnnotationHub with 1 record\n# snapshotDate(): 2024-04-30\n# names(): AH116710\n# $dataprovider: ftp://ftp.ncbi.nlm.nih.gov/gene/DATA/\n# $species: Homo sapiens\n# $rdataclass: OrgDb\n# $rdatadateadded: 2024-04-02\n# $title: org.Hs.eg.db.sqlite\n# $description: NCBI gene ID based annotations about Homo sapiens\n# $taxonomyid: 9606\n# $genome: NCBI genomes\n# $sourcetype: NCBI/ensembl\n# $sourceurl: ftp://ftp.ncbi.nlm.nih.gov/gene/DATA/, ftp://ftp.ensembl.org/p...\n# $sourcesize: NA\n# $tags: c(\"NCBI\", \"Gene\", \"Annotation\") \n# retrieve record with 'object[[\"AH116710\"]]' \n\nShow the codeorg &lt;- OrgDb_Human[[1]]\norg\n\nOrgDb object:\n| DBSCHEMAVERSION: 2.1\n| Db type: OrgDb\n| Supporting package: AnnotationDbi\n| DBSCHEMA: HUMAN_DB\n| ORGANISM: Homo sapiens\n| SPECIES: Human\n| EGSOURCEDATE: 2024-Mar12\n| EGSOURCENAME: Entrez Gene\n| EGSOURCEURL: ftp://ftp.ncbi.nlm.nih.gov/gene/DATA\n| CENTRALID: EG\n| TAXID: 9606\n| GOSOURCENAME: Gene Ontology\n| GOSOURCEURL: http://current.geneontology.org/ontology/go-basic.obo\n| GOSOURCEDATE: 2024-01-17\n| GOEGSOURCEDATE: 2024-Mar12\n| GOEGSOURCENAME: Entrez Gene\n| GOEGSOURCEURL: ftp://ftp.ncbi.nlm.nih.gov/gene/DATA\n| KEGGSOURCENAME: KEGG GENOME\n| KEGGSOURCEURL: ftp://ftp.genome.jp/pub/kegg/genomes\n| KEGGSOURCEDATE: 2011-Mar15\n| GPSOURCENAME: UCSC Genome Bioinformatics (Homo sapiens)\n| GPSOURCEURL: \n| GPSOURCEDATE: 2024-Feb29\n| ENSOURCEDATE: 2023-Nov22\n| ENSOURCENAME: Ensembl\n| ENSOURCEURL: ftp://ftp.ensembl.org/pub/current_fasta\n| UPSOURCENAME: Uniprot\n| UPSOURCEURL: http://www.UniProt.org/\n| UPSOURCEDATE: Thu Apr 18 21:39:39 2024\n\n\n\nShow the codeGRanges_Human &lt;- subset(ah, rdataclass == \"GRanges\" & species == \"Homo sapiens\")\n\ngr &lt;- GRanges_Human[1]\ngr\n\nAnnotationHub with 1 record\n# snapshotDate(): 2024-04-30\n# names(): AH5012\n# $dataprovider: UCSC\n# $species: Homo sapiens\n# $rdataclass: GRanges\n# $rdatadateadded: 2013-03-26\n# $title: Chromosome Band\n# $description: GRanges object from UCSC track 'Chromosome Band'\n# $taxonomyid: 9606\n# $genome: hg19\n# $sourcetype: UCSC track\n# $sourceurl: rtracklayer://hgdownload.cse.ucsc.edu/goldenpath/hg19/database...\n# $sourcesize: NA\n# $tags: c(\"cytoBand\", \"UCSC\", \"track\", \"Gene\", \"Transcript\",\n#   \"Annotation\") \n# retrieve record with 'object[[\"AH5012\"]]'"
  },
  {
    "objectID": "posts/Zotero/Zotero.html",
    "href": "posts/Zotero/Zotero.html",
    "title": "Zotero",
    "section": "",
    "text": "Zotero 7\nhttps://zotero-zh.netlify.app/user-guide/plugins/style"
  },
  {
    "objectID": "posts/Zotero/Zotero.html#标题进度条",
    "href": "posts/Zotero/Zotero.html#标题进度条",
    "title": "Zotero",
    "section": "标题进度条",
    "text": "标题进度条\n在标题列上右击，选择列设置（标题），进入设置窗口。\nColor: 颜色 Opacity: 透明度"
  },
  {
    "objectID": "posts/Zotero/Zotero.html#期刊标签",
    "href": "posts/Zotero/Zotero.html#期刊标签",
    "title": "Zotero",
    "section": "期刊标签",
    "text": "期刊标签\n\neasyScholar 密钥\n密钥申请：在 easyScholar 官网首页登录后，点击右上角用户名进入后台，点击 「开放接口」，即可看见密钥。\n期刊标签\n密钥填写：直接填写到上方 Secret Key 里。"
  },
  {
    "objectID": "posts/Zotero/Zotero.html#标注",
    "href": "posts/Zotero/Zotero.html#标注",
    "title": "Zotero",
    "section": "标注",
    "text": "标注\n通过Shift+P，点标注进入标注的自定义列表。\n左键单击：切换不同的标注方案\n左键单击方案名称：修改方案名称\n长按：修改已有标注。\n点击+：添加新的标注方案。\n长按颜色区域：删除标注方案"
  },
  {
    "objectID": "posts/Rprofile.site/Rprofile.site.html",
    "href": "posts/Rprofile.site/Rprofile.site.html",
    "title": "Rprofile.site",
    "section": "",
    "text": "Show the code# ~\\etc\\Rprofile.site\n\n\n\n# set a CRAN mirror\ngetOption(\"repos\")\noptions(\"BioC_mirror\")\n\n# \"https://mirrors.ustc.edu.cn/CRAN/\"\noptions(repos = c(CRAN = \"https://cran.rstudio.com/\"))\noptions(BioC_mirror = \"https://mirrors.tuna.tsinghua.edu.cn/bioconductor\")\n\n\n\n# ~\\etc\\Rconsole    \n\nlanguage=en\n\n# options(papersize=\"a4\")\n# options(editor=\"notepad\")\n# options(pager=\"internal\")\n\n# set the default help type\n# options(help_type=\"text\")\noptions(help_type = \"html\")\n\n\n\n\n.First &lt;- function() {\n  library(showtext, quietly = T)\n  # font_add(\"Times New Roman Regular\", \"C:/Windows/Fonts/times.ttf\")\n  # font_add(\"Times New Roman Bold\", \"C:/Windows/Fonts/timesbd.ttf\")\n  # font_add(\"Times New Roman Bold Italic\", \"C:/Windows/Fonts/timesbi.ttf\")\n  # font_add(\"Times New Roman Italic\", \"C:/Windows/Fonts/timesi.ttf\")\n  # font_add(\"黑体 常规\", \"C:/Windows/Fonts/simhei.ttf\")\n  # font_add(\"楷体 常规\", \"C:/Windows/Fonts/simkai.ttf\")\n  showtext_auto()\n  # library(data.table)\n  library(conflicted)\n  library(tidyverse)\n  library(patchwork)\n  # library(BiocManager)\n  library(readxl)\n  library(writexl)\n  conflicted::conflict_scout()\n  message(today())\n}\n\n\n.Last &lt;- function() {\n\n}\n\n\n# 更新 R Gui\n\n# installr::updateR()\n\ntools &lt;- c(\n  \"installr\", \"devtools\",\"remotes\",\"conflicted\", \"reticulate\", \"BiocManager\")\n\n\nneeded &lt;- c(\n  \"tidyverse\", \"tidymodels\", \"readxl\", \"writexl\", \"survminer\", \"ggsurvfit\"\n)\n\n# remotes::install_github(\"jbryer/psa\", build_vignettes = TRUE, dependencies = \"Enhances\")\n\noptional &lt;- c(\n  \"ggpubr\",\"pROC\", \"ggprism\", \"ggpattern\", \n  \"pheatmap\", \"ggfortify\", \"ggrepel\", \"ggthemes\",\"ggcorrplot\", \"ggpmisc\", \"plotly\",\n  \"ggraph\", \"tidygraph\", \"svglite\",\n  \n  \n  \"gt\", \"gtsummary\", \"tableone\", \"flextable\",\n  \n  \"esquisse\", \"styler\"\n)\n\n\nlapply(tools, require)"
  },
  {
    "objectID": "posts/Software/RecCloud.html",
    "href": "posts/Software/RecCloud.html",
    "title": "睿客云盘",
    "section": "",
    "text": "睿客网（REC），即中国科学技术大学科研教学资源中心，为科大师生用户提供数据存储、备份、分享等服务的在线平台。"
  },
  {
    "objectID": "posts/PubMed/PubMed_retrieval.html",
    "href": "posts/PubMed/PubMed_retrieval.html",
    "title": "PubMed retrieval",
    "section": "",
    "text": "AND\nOR\nNOT"
  },
  {
    "objectID": "posts/PubMed/PubMed_retrieval.html#布尔逻辑检索",
    "href": "posts/PubMed/PubMed_retrieval.html#布尔逻辑检索",
    "title": "PubMed retrieval",
    "section": "",
    "text": "AND\nOR\nNOT"
  },
  {
    "objectID": "posts/PubMed/PubMed_retrieval.html#截断和通配符",
    "href": "posts/PubMed/PubMed_retrieval.html#截断和通配符",
    "title": "PubMed retrieval",
    "section": "截断和通配符",
    "text": "截断和通配符\n\n通配符wildcard randomi?ed (randomised, randomized)\n截断（*） 可替代 0 个或多个字符\n\n\n\n\n检索词\n结果 2024-10-15\n\n\n\n\nOsteoarthr*[Title/Abstract]\n104,730\n\n\nOsteoarthrosis[Title/Abstract]\n3,585\n\n\nosteoarthritis[Title/Abstract]\n95,813\n\n\nOsteoarthritides[Title/Abstract]\n5"
  },
  {
    "objectID": "posts/PubMed/PubMed_retrieval.html#filter",
    "href": "posts/PubMed/PubMed_retrieval.html#filter",
    "title": "PubMed retrieval",
    "section": "Filter",
    "text": "Filter\n“Clinical Trial” [Publication Type]\n“Randomized Controlled Trial” [Publication Type]"
  },
  {
    "objectID": "posts/PubMed/PubMed_retrieval.html#msh",
    "href": "posts/PubMed/PubMed_retrieval.html#msh",
    "title": "PubMed retrieval",
    "section": "MSH",
    "text": "MSH\nMeSH (Medical Subject Headings)\n主题词 + 自由词\n\n\n\n主题词\n自由词\n\n\n\n\nImmune Checkpoint Inhibitors\n\n\n\nRadiotherapy\n\n\n\nsmall cell lung carcinoma\n\n\n\ndrug treatment"
  },
  {
    "objectID": "posts/PubMed/PubMed_retrieval.html#数据库",
    "href": "posts/PubMed/PubMed_retrieval.html#数据库",
    "title": "PubMed retrieval",
    "section": "数据库",
    "text": "数据库\n\nPubMed\n\n\nCochrane Central Register of Controlled Trials， CENTRAL\n\n\nEmbase"
  },
  {
    "objectID": "posts/PropensityScore/psm.html",
    "href": "posts/PropensityScore/psm.html",
    "title": "Propensity score matching",
    "section": "",
    "text": "Propensity score matching (Nature Methods)"
  },
  {
    "objectID": "posts/BioProtocols/WB.html",
    "href": "posts/BioProtocols/WB.html",
    "title": "Western Blot",
    "section": "",
    "text": "蛋白质免疫印迹（protein immunoblot）"
  },
  {
    "objectID": "posts/BioProtocols/WB.html#试剂和仪器",
    "href": "posts/BioProtocols/WB.html#试剂和仪器",
    "title": "Western Blot",
    "section": "试剂和仪器",
    "text": "试剂和仪器\n\n试剂\n\nPBS\n高效RIPA裂解液\nWB及Co-Ip裂解液\nBCA法：A液，B液\n5 × loading buffer\n电泳缓冲液\n转膜缓冲液：700ml \\(ddH_2O\\) ： 200ml 甲醇 ：100ml 10×转膜液\n封闭液\n1×TBST\n一抗\n二抗\n一抗稀释液\n二抗稀释液\n显影液：A液，B液\n\n\n\n仪器\n\n恒温摇床\n冷冻离心机\n96孔酶标板"
  },
  {
    "objectID": "posts/BioProtocols/WB.html#实验操作",
    "href": "posts/BioProtocols/WB.html#实验操作",
    "title": "Western Blot",
    "section": "实验操作",
    "text": "实验操作\n所有操作应于冰上/4℃ 进行\n\n蛋白提取\n\n洗涤细胞 细胞来源：动物信息、编号、性别、年龄、体重、清洁度、细胞株、基因信息\n裂解\n\n蛋白定量 样品所有人姓名，样品制备或分装年月日，全部基本信息（批号、纯度、浓度） 例如：AlexFluoro647-G3-(GfO)9,365 uM in ddH2O by UV@647nm,95%(MALDI),LY,2021.07.21\n\n96孔板\nBCA，稀释10倍\n恒温37℃孵育30min 具体：恒温孵育 9日11:34至12:05\n酶标仪，ABS，562nm 具体：在562nm的紫外吸收（A1+A2+A3/3=A平均 ） \n计算浓度\n\n蛋白变性\n\nprotein:5×loading buffer=4:1稀释\n95℃加热5分钟\n若是Co-IP，利用beads说明书\n\n计算上样量\n\n\\(\\frac{上样量(μg)}{c×8}\\)\n\n电泳\n\n预制胶，撕掉红色条膜\n电泳液\n恒压100-140V，60min\n\n转膜\n\n甲醇激活膜\n凝胶水冲，转膜液激活，“黑胶”\n转膜液平衡膜\n“白膜”\n赶走气泡\n恒流280mA，60-90min\n\n封闭\n\n5%奶粉TBST溶液\n摇床50，1h\n\n一抗孵育\n\n一抗稀释液1：1000\n摇床50，4℃ .pm~ .am,\nTBST洗涤，3min×3\n\n二抗孵育\n\n二抗稀释液1：4000~5000\n摇床50，室温1h\nTBST洗涤，3min×3\n\n显影\n\n配制显影液\n显影仪 电脑文件夹数据图像命名：姓名日期参数Marker/Samples 结果：具体数值/图像/现象/颜色\n\n\n多用图表\n\nWB\n\n\n步骤\n2024-11-12\n2024-11-14\n……\n2024-11-19\n\n\n\n\n1.动物模型\n\n\n\n\n\n\n2.细胞\n\n\n\n\n\n\n3.蛋白提取\n\n\n\n\n\n\n4.蛋白定量\n\n\n\n\n\n\n……\n\n\n\n\n\n\n\n成功的失败的、反思总结\n重复、阴性对照\n奇偶页法\n左边写实验设计 假设 对照 原始数据 草图 现象\n右边正式步骤 数据 分析\n所有过程都务必记录"
  },
  {
    "objectID": "posts/BioProtocols/immunoprecipitation.html",
    "href": "posts/BioProtocols/immunoprecipitation.html",
    "title": "immunoprecipitation",
    "section": "",
    "text": "免疫沉淀"
  },
  {
    "objectID": "posts/BioProtocols/immunoprecipitation.html#co-immunoprecipitation-co-ip",
    "href": "posts/BioProtocols/immunoprecipitation.html#co-immunoprecipitation-co-ip",
    "title": "immunoprecipitation",
    "section": "co-immunoprecipitation (Co-IP)",
    "text": "co-immunoprecipitation (Co-IP)\n免疫共沉淀\n完整蛋白质复合物（即抗原以及与其结合的任何蛋白质或配体）的免疫沉淀称为免疫共沉淀 （Co-IP）。Co-IP 的工作原理是选择一种靶向已知蛋白质的抗体，该蛋白质被认为是更大蛋白质复合物的成员。通过用抗体靶向该已知成员，有可能将整个蛋白质复合物从溶液中拉出，从而识别复合物的未知成员。\n当复合物中涉及的蛋白质彼此紧密结合时，这种方法就会起作用，从而可以通过用抗体锁定一个成员来将复合物的多个成员从溶液中拉出。这种将蛋白质复合物从溶液中拉出的概念有时被称为“pull-down”。Co-IP 是一种强大的技术，分子生物学家经常使用它来分析蛋白质-蛋白质相互作用。"
  },
  {
    "objectID": "posts/BioProtocols/immunoprecipitation.html#chromatin-immunoprecipitation-chip",
    "href": "posts/BioProtocols/immunoprecipitation.html#chromatin-immunoprecipitation-chip",
    "title": "immunoprecipitation",
    "section": "Chromatin immunoprecipitation (ChIP)",
    "text": "Chromatin immunoprecipitation (ChIP)\n染色质免疫沉淀"
  },
  {
    "objectID": "posts/BioProtocols/WB.html#试剂和仪器-云端试剂档案",
    "href": "posts/BioProtocols/WB.html#试剂和仪器-云端试剂档案",
    "title": "Western Blot",
    "section": "试剂和仪器 云端试剂档案",
    "text": "试剂和仪器 云端试剂档案\n\n试剂\n\nPBS\n高效RIPA裂解液\nWB及Co-Ip裂解液\nBCA法：A液，B液\n5 × loading buffer\n电泳缓冲液\n转膜缓冲液：700ml \\(ddH_2O\\) ： 200ml 甲醇 ：100ml 10×转膜液\n封闭液\n1×TBST\n一抗\n二抗\n一抗稀释液\n二抗稀释液\n显影液：A液，B液\n\n\n\n仪器\n\n恒温摇床\n冷冻离心机 参数 转速 半径\n96孔酶标板"
  },
  {
    "objectID": "posts/Graphics/ggforce/sina.html",
    "href": "posts/Graphics/ggforce/sina.html",
    "title": "sina 图",
    "section": "",
    "text": "（小提琴图 + 抖散图）= sina 图\n\nShow the codelibrary(ggforce)\n\n\nggplot(mpg,aes(x = drv, y = hwy ))+\n    geom_sina()\n\n\n\n\n\n\n\n\nShow the codeggplot(mpg,aes(x = drv, y = hwy ))+\n    geom_violin()+\n    geom_jitter(width = 0.25, size = 0.85)"
  }
]